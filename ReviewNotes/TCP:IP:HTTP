TCP/IP/HTTP

TCP重传机制:
	1.超时重传
		RTT:Round-Trip Time 往返时延
		RTO:Retransmission Timeout 超时重传
		超时重传时间RTO的值应该略大于报文往返RTT的值
	2.快速重传
		以数据驱动
		当收到几个相同ack报文时, 会再定时器过期之前重传丢失的报文段	
		当有三个ack seq2时[发送端不清楚三个连续的ack2是谁传回来的]  不能确定是重传seq2 还是Seq2、Seq3、Seq4、Seq5
	3.SACK: 选择性确定
		tcp头部有一个sack的东西, 讲缓存的地图发送给发送方
		如上收到三个ack2时 会触发快速重发机制, 通过sack
	4.D-SACK
		使用了 SACK 来告诉「发送方」有哪些数据被重复接收了


差错控制:
	1.奇偶校验法
	2.循环冗余校验法

流量控制:  为了避免发送发的数据填满接收方的缓存
	如果发送方把数据发送的过快, 接收方可以能会来不及接受, 会造成数据的丢失
	TCP的流量控制是利用滑动窗口机制实现的, 接收方在返回的数据中会包含自己的接收窗口的大小, 以控制发送发的数据发送
	先收缩窗口 过段时间再减少缓存, 可以避免丢包

拥塞控制:  避免发送方的数据从满整个网络
	 为了防止过多的数据注入到网络中, 可以使网络中的路由器或链路不至于过载
	 我们在前面提到过发送窗口 swnd 和接收窗口 rwnd 是约等于的关系
	 由于入了拥塞窗口的概念后，此时发送窗口的值是swnd = min(cwnd, rwnd)，也就是拥塞窗口和接收窗口中的最小值
	 没有出现拥塞 cwnd会变大,,  如果出现拥塞 cwnd会变小
	 发送方 没有在规定时间内接收到ack应答报文, 也就是发生了超时重传, 就会认为网络出现了拥塞

	 1.慢启动
	 	刚建立连接完成后, 首先慢启动的过程, 一点点的提高发送数据包的数量
	 	当慢启动门限(ssthresh: slow start threshold)状态变量
	 		当 cwnd < ssthresh 时，使用慢启动算法。
			当 cwnd >= ssthresh 时，就会使用「拥塞避免算法」
	 2.拥塞避免
	 	当cwnd超过慢启动门限ssthresh就会进去拥塞避免算法, 没收到一个ack是cwnd就会增加1/cwnd
	 3.拥塞发生
	 	会发生数据包重传, 超时重传和快速重传
	 4.快速恢复

	 慢启动(发送数据指数增长) -> 拥塞避免(线性增长)
Ping:
	ICMP协议
		查询报文: 
			回送消息 
				类型0: 表示回送应答  发送端 -> 接收端
				类型8: 表示回送请求  接收端 -> 发送端
		差错报文:
			类型3: 目标不可达消息,  原因在报文 代码字段
				0: 网络不可达: 路由器中的路由器表匹配不到接收方IP的网络号
				1: 主机不可达: 路由器中的路由器表没有该主机的信息, 或者该主机没有连接到网络
				2: 协议不可达: 对端主机禁止TCP协议的访问
				3: 端口不可达: 访问对端主机8080端口时, 对端主机没有进程监听8080端口
				4: 需要进行分片但设置了不分片: 发送端IP首部设置了 分片禁止标志位=1, 图中路由器遇到超过MTU(最大传输单元), 不会进行分片 而是直接抛弃
			类型4: 原点抑制消息
				在使用低速广域线路的情况下, 链接WAN的路由器可能遇到网络拥堵的问题, 
				原点抑制消息是为了缓和这种拥堵情况
			类型5: 重定向消息
				如果路由器发现发送端主机使用了不是最优的路径发送数据,会发送重定向消息(最合适的路由信息和源数据)给主机
			类型11: 超时消息
				IP 包中有一个字段叫做 TTL （Time To Live，生存周期），它的值随着每经过一次路由器就会减 1，直到减到 0 时该 IP 包会被丢弃, IP路由会发送超时新消息给发送端主机


洪水攻击:
	攻击者对网络资源发送过量数据时就发生了洪水攻击
	ARP协议[ip转成mac地址]:


为什么TCP协议有TIME_WAIT状态?

TCP 与 UDP区别:
	TCP: 面向连接, 提供可靠的数据流, UDP 不是
	TCP: 传输单位 TCP报文段, UDP 用户数据报
	TCP: 注重数据安全性, UDP传输快

tcp 防止乱序和丢包: 
	1. SYN(synchronous 建立联机)
		ACK(acknowledgement 确认)

	三次握手: 
		1.client 发送syn(syn = j)包 等待服务器确认
		2.服务器收到syn包, 必须确认客户的syn(ack = j + 1), 同时发送一个syn包(syn = k)[ack = j+1, syn = k]
		3.客户端收到syn+ack 同时发送ACK(ack = k+1)

	四次挥手:
		1.主动关闭方发送一个fin, 关闭主动方到被动方
		2.被动方收到fin包治好发送一个ack
		3.被动方发送一个fin, 用来关闭被动方 到主动方的数据传送
		4.主动方发送一个ack

HTTP和socket区别:
	http:是客户端用http协议,发送请求是封装http 请求头, 绑定数据,
	     只能客户端发请求 服务器给回应, 一次请求完毕后则断开连接
	     如果http长连接时  可以服务器发消息
	socket:客户端和服务器使用socket进行连接, 没有规定连接后断开, 
	       及时性强, 并且发送数据量比较大 主要类CFSocketRef

DNS如何工作:
	根据域名查主机
1. 网络分层
OSI: 物理层 数据链路层 网络层 传输层 [会话层 表示层] 应用层
 物理层: IEEE802.3   通过没接传输bit
 数据链路层: mac      讲比特组装包装成帧 点对点传递
 网络层: IP ICMP		负责数据包传递
 传输层: TCP, UDP, ARP    可靠报文传输
 会话层:?				建立 管理 终止会话
 表示层:				对文件进行传输加密压缩
 应用层: HTTP DNS  SMTP FTP  

 网络四层: 网络接口层, 网际层, 运输层, 应用层

ARP 根据ip找MAC地址

2.IP地址分类:
 A: 1-126.255.255.255 以0开头
 B: 128-191.255.2555.255 以10开头
 C: 192-223.255.255.255  以110开头的
 D: 224-239.255.255.255  以1110开头
 E: 保留

3. ARP是地址解析协议, 工作原理
	1. 每个主机都会再自己的ARP缓冲区中建立一个ARP列表, 表示IP和MAC之间的对应关系
	2. 发送数据的时候吗检查列表中是否含有目标主机的mac地址, 如果有直接发送, 如果没有 向所有主机发送
	3. 本网络上的所有主机收到后检查包中IP和自己的ip 如果是的话, 将包中ip和mac地址写入自己的ARP列表中, 然后将自己mac写入
	4, 源主机收到后更新,  如果没收到ARP响应包, 表示查询失败

DNS域名系统: 描述工作原理
 DNS客户机需要使用的时候 会查询DNS服务器来解析该名称, 客户端查询发送查询信息包括: 指定的DNS域名, 指定的查询类型, DNS域名的指定类别,
 先去查DNS缓存, 如果缓存没有, 则给DNS服务气发送UDP请求, 接收结果 然后经结果返回给浏览器
 查询流程: 1.现在本机的DNS里查 
 		  2.本机没有 就去向com域DNS服务器发送查询消息, 没有 com会返回tmall.com的DNS服务器的IP地址



1、一个 TCP 连接可以对应几个 HTTP 请求？(提示，这在问你HTTP1.0和1.1的区别)
	HTTP1.0中一个服务器再发送完一个HTTP响应后就会断开, 有些支持了 Connection: keep-alive, 不断开
	HTTP1.1中 就把Connection写进标准, 默认开启 除非Connection: close

2、一个 TCP 连接中 HTTP 请求发送可以一起发送么（比如一起发三个请求，再三个响应一起接收）？(提示，这就是在问你HTTP2.0和HTTP1.1协议的区别)

http1.1单个TCP连接 同一时刻只能处理一个请求
http2.0提供了多路传输, 可以在一个TCP连接中同时完成多个HTTP请求

3、浏览器对同一Host建立TCP连接到数量有没有限制？(拜托，一个网站那么多图片，开一个TCP连接，按顺序下载？那不是等到死？)
	http 1.1的时候chrome最多允许对同一个host建立6个tcp链接
	http 1.1 链接数量都是浏览器设置的


HTTP2.0特性:
	多路复用
	二进制分帧
	首部压缩

HTTP SSL/TLS:
	1. 服务端 有公钥私钥
	2. 服务端发送公钥给客户端
	3. 客户端解析, 证书没问题, 用公钥加密一个随机值, 生成一个秘钥
	4.服务端接受加密信息
	5.服务端用私钥解密, 得到随机值 后用来对称加密


HTTPS 加密过程: 发布机构发布的证书
	证书包含内容: 1.证书的发布机构CA, 2.证书的有效期, 3.公钥, 4.证书所有者, 5.签名
	客户端验证证书是否可信
	1.读取证书中的所有者, 有效期等信息校验,   然后查找本地内置的受信任的证书发布机构CA, 与服务器发来的证书中的颁布者CA对比, 用于校验证书是否为合法机构颁发
	2.如果找不到, 证书不可信
	3.如果找到, 取出内置的颁发者CA的公钥, 对服务器发来的证书里面的签名进行解密
	4.使用相同的hash算法计算出服务器发来的证书的hash值, 与证书中的签名做对比
	5.如果对比一致, 证明服务器发来的证书合法,  取证书中的公钥进行后续加密

对称加密:
	AES:(Rijidael算法)
		分组加密算法, 通过置换和替换迭代加密
		AES原文：a1a2a3a4 a5a6a7a8 a9a10a11a12 a13a14a15a16...
		a1    a5    a9    a13

		a2    a6    a10  a14

		a3    a7    a11  a15

		a4    a8    a12  a16

链接怎么发出 并得到数据的:
	输入网址
	DNS服务器进行域名映射找到地址
	HTTP客户端进程在80端口发起TCP链接, 客户端和服务器进程中会有一个socket链接
	HTTP客户端向服务器发送请求报文
	服务器接收报文 并解析 检索对象
	封装数据到响应报文中 通过socket发送
	等待客户端接收完响应报文
	HTTP服务器通知TCP断开
	客户端接受完响应报文后断开连接



UDP: UDP首部 16位源端口+16位目的端口+UDP长度+校验和
	长度和校验和: 校验和是可选的,  如果关闭端到端的UDP检验和功能，那么这些差错在UDP数据报中就不能被检测出来






